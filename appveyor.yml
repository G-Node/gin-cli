version: '{build}'
build: off

clone_folder: c:\gopath\src\github.com\G-Node\gin-cli

stack: go 1.11

environment:
  GOPATH: c:\gopath
  BINDIR: bin


install:
  # go stuff
  - set PATH=%GOPATH%\bin;c:\go\bin;%PATH%
  - go version
  - go env
  - go get -u github.com/golang/lint/golint

build_script:
  - cd %clone_folder%
  # download deps
  - go get github.com/spf13/viper
  - go get github.com/spf13/cobra
  - go get github.com/howeyc/gopass
  - go get golang.org/x/crypto/ssh
  - go get github.com/G-Node/gin-core/gin
  - go get github.com/G-Node/gin-repo/wire
  - go get golang.org/x/crypto/ssh
  - go get github.com/gogits/go-gogs-client
  - go get github.com/fatih/color
  - go get github.com/hashicorp/go-version
  - go get github.com/shibukawa/configdir
  - go get github.com/bbrks/wrap
  - go get github.com/docker/docker/pkg/term
  - go get github.com/alecthomas/template
  - go get github.com/dustin/go-humanize
  - go vet ./...
  - gofmt -s -l .
  - golint github.com/G-Node/gin-cli...

after_test:
  - go build -ldflags "-X main.gincliversion=APPVEYOR-%APPVEYOR_REPO_NAME%-%APPVEYOR_REPO_BRANCH% -X main.build=%APPVEYOR_BUILD_NUMBER% -X main.commit=%APPVEYOR_REPO_COMMIT%" -o gin.exe .

# to disable deployment
deploy: off

# Uncomment on_finish block to enable RDP
# on_finish:
#   - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
