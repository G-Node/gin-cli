language: go

dist: trusty
sudo: required

services:
    - docker

go:
  - 1.9
  - tip

matrix:
    allow_failures:
        - go: tip

before_install:
  - sudo apt-get update

install:
  # tools
  - go get github.com/golang/lint/golint
  - go get github.com/GeertJohan/fgt
  # coveralls
  - go get github.com/mattn/goveralls
  - go get golang.org/x/tools/cmd/cover
  # dependencies
  - go get github.com/docopt/docopt-go
  - go get github.com/spf13/viper
  - go get github.com/howeyc/gopass
  - go get golang.org/x/crypto/ssh
  - go get github.com/G-Node/gin-core/gin
  - go get github.com/G-Node/gin-repo/wire
  - go get golang.org/x/crypto/ssh
  - go get github.com/gogits/go-gogs-client
  - go get github.com/fatih/color
  - go get github.com/hashicorp/go-version
  - go get github.com/shibukawa/configdir
  # import path symlink for forks
  - if [ ! -d ${GOPATH}/src/github.com/G-Node/gin-cli ]; then ln -vs $(pwd) ${GOPATH}/src/github.com/G-Node/gin-cli; fi

script:
  - make
  - cp ./build/gin ./gin-cli-test/bin/gin
  - ./gin-cli-test/start-server.sh
  - while ! curl localhost:3000 -so /dev/null; do sleep 1; done
  - ./gin-cli-test/run-cont-tests.sh

after_failure:
  # print log for debugging
  # TODO: Upload it somewhere for easier access
  - cat ./gin-cli-test/scripts/log/gin.log
